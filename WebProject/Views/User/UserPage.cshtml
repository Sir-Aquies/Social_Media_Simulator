@model DynamicUser

@{
	ViewData["Title"] = Model.PageUser.UserName ?? "User not Found";
	ViewData["UserId"] = Model.User.Id;
}

<link rel="stylesheet" href="~/css/UserCSS.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/HomePageCSS.css" asp-append-version="true"/>
<link rel="stylesheet" href="~/css/PostContainer.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/PostForms.css" asp-append-version="true" />

<section class="box-container">
	<section class="left-box">
		<div class="user-info">
			@if (Model.PageUser.ProfilePicture != null) 
			{
				<img class="user-pic" src="@(Model.PageUser.ProfilePicture.StartsWith("https") ? "" : "data:image/png;base64,")@Model.PageUser.ProfilePicture" alt="@Model.PageUser.UserName picture" />
			}
			else
			{
				<img class="user-pic" src="" />
			}

			<div class="user-username">@Model.PageUser?.UserName</div>

			<div class="user-name">@Model.PageUser?.Name</div>

			<div class="user-description">@Model.PageUser?.Description</div>

			<div class="user-dob">@Model.PageUser?.DateofBirth.ToShortDateString()</div>
		</div>
	</section>

	<section class="center-box" id="UserPostContainer">
		@if (Model.PageUser != null)
		{
			@if (Model.PageUser.Id == Model.User.Id)
			{
				<div class="create-post-container">
					<button type="button" class="create-post-button" onclick="CreatePostTab()">Create New Post</button>
				</div>
			}

			@foreach(PostModel post in Model.PageUser.Posts.Reverse())
			{
				<article id="@post.User.UserName@post.Id" onclick="location = '@post.User.UserName/hop/@post.Id'" data-post-container>
					<partial name="Post" model="post"></partial>
					@{
						post.Comments = post.Comments.OrderByDescending(c => c.Likes).ToList();
					}
					@for (int i = 0; i < post.Comments.Count; i++)
					{
						if (i < 2)
						{
							<partial name="Comment" model="post.Comments[i]"></partial>
						}
						else
						{
							<a class="complete-post-button" href="/@post.User.UserName/hop/@post.Id">View all the Comments</a>
							break;
						}
					}
				</article>
			}
		}

	</section>
	
	<section class="right-box">
		@*@await Component.InvokeAsync("AllUsers")*@
		@await Component.InvokeAsync("TendencyUsers", new { amount = 10 })
	</section>
</section>

<script src="~/js/AsyncCRUD.js" asp-append-version="true"></script>
<script src="~/js/PostsScript.js" asp-append-version="true"></script>
<script src="~/js/CommentsScript.js" asp-append-version="true"></script>
<script src="~/js/ImagePrev.js" asp-append-version="true"></script>
<script>
	function ShowPostImg(element) {
		const img = element.nextElementSibling;
		img.id = "currentimg";
		$(`#${img.id}`).slideToggle();
		img.id = "";
	};
</script>