@using Microsoft.AspNetCore.Identity;
@model DynamicUser

@{
	ViewData["Title"] = Model.PageUser.UserName ?? "User not Found";
	ViewData["UserId"] = Model.User.Id;
	PostModel post = Model.PageUser.Posts[0];
}

<link rel="stylesheet" href="~/css/UserCSS.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/HomePageCSS.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/PostContainer.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/PostForms.css" asp-append-version="true" />

<section class="box-container" id="UserPostContainer">
	<section class="left-box">
		<div class="user-info">
			@if (Model.PageUser.ProfilePicture != null)
			{
				<img class="user-pic" src="@(Model.PageUser.ProfilePicture.StartsWith("https") ? "" : "data:image/png;base64,")@Model.PageUser.ProfilePicture" alt="@Model.PageUser.UserName picture" />
			}
			else
			{
				<img class="user-pic" src="" />
			}

			<div class="user-username">@Model.PageUser?.UserName</div>

			<div class="user-name">@Model.PageUser?.Name</div>

			<div class="user-description">@Model.PageUser?.Description</div>

			<div class="user-dob">@Model.PageUser?.DateofBirth.ToShortDateString()</div>
		</div>
	</section>

	<section class="center-box">
		<article id="@post.Id" data-post-container>
			<partial name="Post" model="post"></partial>

			@foreach (CommentModel comment in post.Comments.OrderByDescending(c => c.Likes))
			{
				<partial name="Comment" model="comment"></partial>
			}
		</article>
	</section>

	<section class="right-box">
		@*@await Component.InvokeAsync("AllUsers")*@
		@await Component.InvokeAsync("TendencyUsers", new { amount = 10 })
	</section>
</section>

<script src="~/js/AsyncCRUD.js" asp-append-version="true"></script>
<script src="~/js/PostsScript.js" asp-append-version="true"></script>
<script src="~/js/CommentsScript.js" asp-append-version="true"></script>
<script src="~/js/ImagePrev.js" asp-append-version="true"></script>

<script>
	function RedirectToUserPage() {
		location = '/';
	}
</script>